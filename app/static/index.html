<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        h1 {
            margin-bottom: 20px;
            font-size: 24px;
        }
        .card {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .label {
            font-weight: 600;
            color: var(--tg-theme-hint-color, #999);
        }
        .value {
            text-align: right;
        }
        button {
            width: 100%;
            padding: 14px;
            background: var(--tg-theme-button-color, #2196F3);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        button:active {
            opacity: 0.8;
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .loading {
            background: #FFF3CD;
            color: #856404;
        }
        .success {
            background: #D4EDDA;
            color: #155724;
        }
        .error {
            background: #F8D7DA;
            color: #721C24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Money App</h1>

        <div id="status"></div>

        <div class="card">
            <h2 style="margin-bottom: 15px;">–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div id="user-info">
                <p style="text-align: center; color: #999;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
            </div>
        </div>

        <button onclick="loadUserData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </div>

    <script>
        // API_URL —Ç–µ–ø–µ—Ä—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π - –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ
        const API_URL = window.location.origin;
        const tg = window.Telegram.WebApp;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram WebApp
        tg.expand();
        tg.enableClosingConfirmation();

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('load', loadUserData);

        async function loadUserData() {
            const statusDiv = document.getElementById('status');
            const userInfoDiv = document.getElementById('user-info');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ initData
            if (!tg.initData) {
                statusDiv.innerHTML = '<div class="error">‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram</div>';
                userInfoDiv.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            statusDiv.innerHTML = '<div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';

            try {
                const response = await fetch(`${API_URL}/api/telegram-user`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        init_data: tg.initData
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = '<div class="success">‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã</div>';

                    const user = data.user;
                    userInfoDiv.innerHTML = `
                        <div class="info-row">
                            <span class="label">ID:</span>
                            <span class="value">${user.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">–ò–º—è:</span>
                            <span class="value">${user.first_name}</span>
                        </div>
                        ${user.last_name ? `
                        <div class="info-row">
                            <span class="label">–§–∞–º–∏–ª–∏—è:</span>
                            <span class="value">${user.last_name}</span>
                        </div>
                        ` : ''}
                        ${user.username ? `
                        <div class="info-row">
                            <span class="label">Username:</span>
                            <span class="value">@${user.username}</span>
                        </div>
                        ` : ''}
                        <div class="info-row">
                            <span class="label">–Ø–∑—ã–∫:</span>
                            <span class="value">${user.language_code.toUpperCase()}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Premium:</span>
                            <span class="value">${user.is_premium ? '‚≠ê –î–∞' : '–ù–µ—Ç'}</span>
                        </div>
                    `;

                    // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
                    tg.HapticFeedback?.notificationOccurred('success');

                    // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 2000);

                } else {
                    statusDiv.innerHTML = `<div class="error">‚ùå ${data.detail}</div>`;
                    tg.HapticFeedback?.notificationOccurred('error');
                }

            } catch (error) {
                statusDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
                tg.HapticFeedback?.notificationOccurred('error');
            }
        }
    </script>
</body>
</html>